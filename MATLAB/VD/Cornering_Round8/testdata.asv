clc; clear; close all; 
data = load("B1965run19.mat");
time = data.ET;

IncAngle = data.IA;
SlipRatio = data.SR;
SlipAngle = data.SA;
Fx = data.FX; %Long. Force - N
Fy = data.FY; %Lateral Force - N
Fz = abs(data.FZ); %Normal Force - N
tempInner = data.TSTI;
tempCenter = data.TSTC;
tempOuter = data.TSTO;
AligningMoment = data.MZ; 

% Friction
lateralFriction = Fy./abs(Fz);
longFriction = Fx./abs(Fz);
[peakLateralFriction indexLateral] = max(lateralFriction)
[peakLongFriction indexLong] = max(longFriction)
figure
plot(Fz,lateralFriction)
xlabel('Fy')
ylabel('Friction coeff')
title('Friction coeff by normal force')
time(indexLateral)


%[peakTemp indexTemp]= max(tempCenter)
%tempCenter(indexLateral)
%[peakLateral indexLateral] = max(abs(Fz))



%Lateral force against time
figure
plot(time,Fy)
title('Lateral Force')

%Slip angle against time
figure 
plot(time, SlipAngle)
title('Slip Angle & Normal Load')

%Normal load vs time
hold on%figure
yyaxis right
plot(time, Fz)
%title('Normal Load')

%SLIP ANGLE VS LATERAL FORCE
figure 
plot(SlipAngle, Fy)

start1100 = 300; % start of 1100N run
end1100 = 950; % end of 1100N run

start1000 = 20300; %start of 1000N run
end1000 = 21000; %end of 1000N run

start400 = 51500; %start of 400N run
end400 = 52200; %end of 400N run

start200 = 16500; 
end200 = 17300;
%avg = mean(Fz(start200:end200))

figure
plot(SlipAngle(start1100:end1100),Fy(start1100:end1100),LineWidth=3)
hold on
plot(SlipAngle(start1000:end1000), Fy(start1000:end1000), LineWidth=3)
hold on
plot(SlipAngle(start400:end400),Fy(start400:end400),LineWidth=3)
hold on
plot(SlipAngle(start200:end200), Fy(start200:end200), LineWidth=3)
grid on
xlabel('slip angle (Deg)')
ylabel('Lateral Force(N)')
legend('1100N','1000N','400N','200')
title('Lateral Force vs Slip Angle');

%Aligning Moment
figure
plot(SlipAngle(start1100:end1100), AligningMoment(start1100:end1100))
hold on 
plot(SlipAngle(start400:end400), AligningMoment(start400:end400))
grid on
title('Aligning Moment vs Slip angle @1100 & 400N Fz')


%Tire temp
figure 
plot(time(start1000:end1000), tempInner(start1000:end1000))
%hold on 
%plot(time, tempCenter)
%hold on
%plot(time,tempOuter)

%Print tireID to command window
fprintf(data.tireid)

fprintf(data.testid)

%SLIP RATIO VS LONG FORCE
max(abs(Fx))
max(SlipRatio)
figure
start = 1;
endd = 100;
plot(SlipRatio(start:endd), abs(Fx(start:endd)))